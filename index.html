<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFlow OS // JPG Systems</title>

    <!-- Tailwind + Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #0f172a; }
        .brutalist-card { background: white; border: 2px solid #e2e8f0; border-radius: 12px; transition: all 0.2s; }
        .active-turn { border-color: #22c55e; background-color: #f0fdf4; box-shadow: 0 4px 12px rgba(34, 197, 94, 0.1); }
        .status-pill { height: 6px; flex: 1; border-radius: 99px; background: #e2e8f0; }
        .status-pill.complete { background: #3b82f6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>

<body class="p-4 md:p-8">

<div id="root" class="max-w-xl mx-auto">
    <div class="flex items-center justify-center min-h-[60vh] text-stone-400 italic">
        <p class="animate-pulse">Initializing FleetFlow Core...</p>
    </div>
</div>

<script>
/* =========================
   SYSTEM CONSTANTS & STATE
========================= */

const STATUS_FLOW = [
    'SURVEY',
    'PENDING_APPROVAL',
    'AWAITING_SIGNATURE',
    'LOADING',
    'AWAITING_DISPATCH',
    'EN_ROUTE_TO_WH',
    'IN_WAREHOUSE',
    'AWAITING_WH_DISPATCH',
    'OUT_FOR_DELIVERY',
    'PAYMENT_PENDING',
    'COMPLETED'
];

const roleMap = {
    SURVEY: 'driver',
    PENDING_APPROVAL: 'office',
    AWAITING_SIGNATURE: 'client',
    LOADING: 'driver',
    AWAITING_DISPATCH: 'office',
    EN_ROUTE_TO_WH: 'driver',
    IN_WAREHOUSE: 'warehouse',
    AWAITING_WH_DISPATCH: 'office',
    OUT_FOR_DELIVERY: 'driver',
    PAYMENT_PENDING: 'office',
    COMPLETED: 'system'
};

let state = {
    role: 'driver',
    status: 'SURVEY',
    jobId: 'FLEET-B02-2026',
    helperOpen: false,
    inventory: [
        { name: 'Sectional Sofa', cf: 65, condition: 'Pre-existing scratch' },
        { name: 'Dining Table', cf: 30, condition: 'Verified' }
    ],
    earnings: 450.00
};

/* =========================
   RENDER ENGINE
========================= */

function render() {
    const root = document.getElementById('root');
    const currentIndex = STATUS_FLOW.indexOf(state.status);
    const activeRole = roleMap[state.status];
    const isMyTurn = state.role === activeRole;
    const totalCF = state.inventory.reduce((sum, i) => sum + i.cf, 0);

    root.innerHTML = `
        <!-- HEADER -->
        <header class="flex justify-between items-center mb-8 pb-4 border-b border-stone-200">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 w-8 h-8 rounded-lg flex items-center justify-center text-white font-black italic shadow-lg">F</div>
                <h1 class="text-xl font-black uppercase tracking-tighter italic">FleetFLOW</h1>
            </div>

            <div class="flex items-center gap-3">
                <button onclick="toggleHelper()" class="bg-stone-900 text-white px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest italic">
                    Helper
                </button>
                <div class="bg-blue-50 border border-blue-100 text-blue-700 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest italic">
                    Mode: ${state.role}
                </div>
            </div>
        </header>

        ${state.helperOpen ? `
        <div class="mb-6 bg-stone-900 text-white rounded-xl p-4">
            <div class="text-[10px] font-black uppercase tracking-widest text-stone-400 mb-2">
                Fleet Helper
            </div>
            <p class="text-sm text-stone-200">
                Status: ${state.status.replace(/_/g, ' ')}<br>
                Active Role: ${activeRole}<br>
                Total Cubic Feet: ${totalCF}
            </p>
        </div>
        ` : ''}

        <!-- ROLE SWITCHER -->
        <div class="flex gap-1.5 mb-8 overflow-x-auto pb-2 no-scrollbar">
            ${['driver','office','warehouse','client'].map(r => `
                <button onclick="setRole('${r}')" class="px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest ${state.role === r ? 'bg-stone-900 text-white' : 'bg-white text-stone-400 border'}">
                    ${r}
                </button>
            `).join('')}
        </div>

        <!-- BATON -->
        <div class="p-5 mb-6 brutalist-card ${isMyTurn ? 'active-turn' : ''}">
            <div class="flex justify-between items-center">
                <div>
                    <span class="text-[10px] font-black uppercase tracking-widest ${isMyTurn ? 'text-green-600' : 'text-stone-400'}">
                        ${isMyTurn ? '● Action Required' : '○ Pending'}
                    </span>
                    <h3 class="mt-1 font-bold text-lg uppercase italic">${state.status.replace(/_/g, ' ')}</h3>
                </div>
                <div class="text-sm font-black uppercase italic">${activeRole}</div>
            </div>
        </div>

        <!-- PROGRESS -->
        <div class="flex gap-1 mb-10 px-1">
            ${STATUS_FLOW.map((_, i) => `<div class="status-pill ${i <= currentIndex ? 'complete' : ''}"></div>`).join('')}
        </div>

        <main class="space-y-6">
            ${renderRoleContent(isMyTurn, totalCF)}
        </main>

        <footer class="mt-20 border-t pt-8 flex justify-between text-[10px] font-black uppercase tracking-widest opacity-40">
            <div>JPG Systems</div>
            <div>FleetFlow v2.0.26</div>
        </footer>
    `;

    lucide.createIcons();
}

/* =========================
   ROLE CONTENT
========================= */

function renderRoleContent(isMyTurn, totalCF) {
    if (state.role === 'driver') {
        return `
        <div class="bg-amber-50 border-2 border-amber-200 rounded-xl p-4">
            <div class="text-[10px] font-black uppercase tracking-widest text-amber-600">Estimated Payout</div>
            <div class="text-2xl font-black italic">$${state.earnings.toFixed(2)}</div>
        </div>

        <div class="bg-white border rounded-xl overflow-hidden">
            <div class="bg-stone-900 px-4 py-2 text-white flex justify-between">
                <span class="text-[10px] font-black uppercase tracking-widest">Inventory</span>
                <span class="text-[10px]">${totalCF} CF</span>
            </div>
            ${state.inventory.map((item, i) => `
                <div class="p-3 flex items-center gap-3 border-t">
                    <span class="flex-1 font-bold">${item.name}</span>
                    <input type="number" min="0" value="${item.cf}"
                        onchange="updateCF(${i}, this.value)"
                        class="w-20 border rounded px-2 py-1 text-xs font-bold text-right"/>
                    <span class="text-xs font-black">CF</span>
                </div>
            `).join('')}
        </div>

        ${isMyTurn ? `
        <button onclick="advanceStatus()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase tracking-widest italic">
            Submit & Verify
        </button>` : ''}
        `;
    }

    if (state.role === 'office') {
        return `
        <div class="bg-stone-900 text-white rounded-xl p-6">
            <div class="text-[10px] uppercase tracking-widest text-stone-500 mb-4">
                Command View // ${state.jobId}
            </div>
            <div class="text-xs">Margin Secure</div>
        </div>

        ${isMyTurn ? `
        <button onclick="advanceStatus()" class="w-full bg-green-600 text-white py-4 rounded-xl font-black uppercase tracking-widest italic">
            Approve Step
        </button>` : ''}
        `;
    }

    return `
    <div class="text-center py-12 border-2 border-dashed rounded-xl text-stone-400 text-xs font-black uppercase tracking-widest">
        Awaiting ${roleMap[state.status]}
    </div>`;
}

/* =========================
   ACTIONS
========================= */

window.setRole = r => {
    state.role = r;
    render();
};

window.toggleHelper = () => {
    state.helperOpen = !state.helperOpen;
    render();
};

window.updateCF = (index, value) => {
    state.inventory[index].cf = Number(value) || 0;
    render();
};

window.advanceStatus = () => {
    const activeRole = roleMap[state.status];
    if (state.role !== activeRole) {
        alert(`Action belongs to ${activeRole.toUpperCase()}`);
        return;
    }
    const next = STATUS_FLOW.indexOf(state.status) + 1;
    if (next < STATUS_FLOW.length) {
        state.status = STATUS_FLOW[next];
        render();
    }
};

/* =========================
   INIT
========================= */

window.onload = render;
</script>

</body>
</html>
