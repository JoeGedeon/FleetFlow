<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FleetFlow OS // JPG Systems</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
body { font-family: 'Inter', sans-serif; background:#f8fafc; color:#0f172a; }
.brutalist-card { background:white; border:2px solid #e2e8f0; border-radius:12px; }
.active-turn { border-color:#22c55e; background:#f0fdf4; }
.status-pill { height:6px; flex:1; border-radius:999px; background:#e2e8f0; }
.status-pill.complete { background:#3b82f6; }
</style>
</head>

<body class="p-4 md:p-8">
<div id="root" class="max-w-xl mx-auto"></div>

<script>
/* =========================
   CONSTANTS
========================= */

const STATUS_FLOW = [
  'SURVEY','PENDING_APPROVAL','AWAITING_SIGNATURE','LOADING',
  'AWAITING_DISPATCH','EN_ROUTE_TO_WH','IN_WAREHOUSE',
  'AWAITING_WH_DISPATCH','OUT_FOR_DELIVERY','PAYMENT_PENDING','COMPLETED'
];

const roleMap = {
  SURVEY:'driver',
  PENDING_APPROVAL:'helper',
  AWAITING_SIGNATURE:'client',
  LOADING:'driver',
  AWAITING_DISPATCH:'office',
  EN_ROUTE_TO_WH:'driver',
  IN_WAREHOUSE:'warehouse',
  AWAITING_WH_DISPATCH:'office',
  OUT_FOR_DELIVERY:'driver',
  PAYMENT_PENDING:'office',
  COMPLETED:'system'
};

/* =========================
   STATE
========================= */

let state = {
  role:'driver',
  status:'SURVEY',
  jobId:'FLEET-B02-2026',
  inventory:[
    { name:'Sectional Sofa', cf:65, condition:'Scratch' }
  ],
  newItem:{ name:'', cf:'' },
  earnings:450
};

/* =========================
   RENDER
========================= */

function render() {
  const root = document.getElementById('root');
  const idx = STATUS_FLOW.indexOf(state.status);
  const activeRole = roleMap[state.status];
  const isMyTurn = state.role === activeRole;
  const totalCF = state.inventory.reduce((s,i)=>s+i.cf,0);

  root.innerHTML = `
<header class="flex justify-between items-center mb-6 border-b pb-4">
  <h1 class="font-black italic text-xl">FleetFLOW</h1>
  <span class="text-[10px] uppercase font-black">Mode: ${state.role}</span>
</header>

<!-- ROLE ORDER -->
<div class="flex gap-2 mb-6">
  ${['driver','helper','office','warehouse','client'].map(r=>`
    <button onclick="setRole('${r}')"
      class="px-3 py-2 rounded text-[10px] uppercase font-black
      ${state.role===r?'bg-stone-900 text-white':'bg-white border'}">
      ${r}
    </button>
  `).join('')}
</div>

<!-- BATON -->
<div class="brutalist-card p-4 mb-4 ${isMyTurn?'active-turn':''}">
  <div class="flex justify-between">
    <div>
      <div class="text-[10px] uppercase font-black ${isMyTurn?'text-green-600':'text-stone-400'}">
        ${isMyTurn?'● Action Required':'○ Pending'}
      </div>
      <div class="font-bold italic">${state.status.replace(/_/g,' ')}</div>
    </div>
    <div class="uppercase font-black text-sm">${activeRole}</div>
  </div>
</div>

<!-- PROGRESS -->
<div class="flex gap-1 mb-8">
  ${STATUS_FLOW.map((_,i)=>`<div class="status-pill ${i<=idx?'complete':''}"></div>`).join('')}
</div>

<!-- INVENTORY -->
<div class="bg-white border rounded-xl overflow-hidden mb-6">
  <div class="bg-stone-900 text-white px-4 py-2 flex justify-between">
    <span class="text-[10px] uppercase font-black">Inventory</span>
    <span class="text-[10px]">${totalCF} CF</span>
  </div>

  ${state.inventory.map((item,i)=>`
    <div class="flex items-center gap-2 p-3 border-t">
      <span class="flex-1 font-bold">${item.name}</span>
      <input type="number" value="${item.cf}" min="0"
        onchange="updateCF(${i},this.value)"
        class="w-20 text-right border rounded px-2 py-1 text-xs font-bold"/>
      <span class="text-xs font-black">CF</span>
    </div>
  `).join('')}
</div>

<!-- ADD INVENTORY (DRIVER + HELPER ONLY) -->
${['driver','helper'].includes(state.role)?`
<div class="bg-amber-50 border-2 border-amber-200 rounded-xl p-4 mb-6">
  <div class="text-[10px] uppercase font-black mb-2">Add Inventory Item</div>
  <div class="flex gap-2">
    <input placeholder="Item name"
      value="${state.newItem.name}"
      oninput="state.newItem.name=this.value"
      class="flex-1 border rounded px-2 py-1 text-xs"/>
    <input type="number" placeholder="CF"
      value="${state.newItem.cf}"
      oninput="state.newItem.cf=this.value"
      class="w-20 border rounded px-2 py-1 text-xs"/>
    <button onclick="addItem()"
      class="bg-stone-900 text-white px-3 rounded text-xs font-black">
      Add
    </button>
  </div>
</div>`:''}

<!-- ACTION -->
${isMyTurn?`
<button onclick="advanceStatus()"
  class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase italic">
  Advance Step
</button>`:''}

<footer class="mt-16 pt-6 border-t text-[10px] uppercase font-black opacity-40 flex justify-between">
  <span>JPG Systems</span>
  <span>FleetFlow v2.1</span>
</footer>
`;
}

/* =========================
   ACTIONS
========================= */

function setRole(r){ state.role=r; render(); }

function updateCF(i,val){
  state.inventory[i].cf = Number(val)||0;
  render();
}

function addItem(){
  if(!state.newItem.name || !state.newItem.cf) return;
  state.inventory.push({
    name:state.newItem.name,
    cf:Number(state.newItem.cf)
  });
  state.newItem={name:'',cf:''};
  render();
}

function advanceStatus(){
  const activeRole = roleMap[state.status];
  if(state.role!==activeRole){
    alert(`Action belongs to ${activeRole.toUpperCase()}`);
    return;
  }
  const next = STATUS_FLOW.indexOf(state.status)+1;
  if(next<STATUS_FLOW.length){
    state.status=STATUS_FLOW[next];
    render();
  }
}

window.onload = render;
</script>
</body>
</html>
