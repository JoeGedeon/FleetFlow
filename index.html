<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FleetFLOW – MoveMaster OS</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-stone-100 min-h-screen font-sans">

<div id="app" class="max-w-4xl mx-auto p-6"></div>

<script>
/******************************
 * CORE STATE
 ******************************/
const STATUS_FLOW = [
  'driver',
  'helper',
  'office',
  'warehouse',
  'client'
];

const roleMap = {
  driver: 'driver',
  helper: 'helper',
  office: 'office',
  warehouse: 'warehouse',
  client: 'client'
};

const state = {
  role: 'driver',              // active logged-in role
  status: 'driver',            // baton position
  inventory: [
    { name: 'Sofa', cf: 50 },
    { name: 'Dining Table', cf: 30 }
  ],
  driverPay: {
    rate: 35,
    commission: 0.1
  },
  helperPay: {
    rate: 20
  }
};

/******************************
 * DERIVED VALUES
 ******************************/
function totalCF() {
  return state.inventory.reduce((s, i) => s + i.cf, 0);
}

function driverCommission() {
  return (totalCF() * state.driverPay.commission * 10).toFixed(2);
}

/******************************
 * ACTIONS
 ******************************/
window.setRole = role => {
  state.role = role;
  render();
};

window.advanceStatus = () => {
  const requiredRole = roleMap[state.status];

  if (state.role !== requiredRole) {
    alert(`Only ${requiredRole.toUpperCase()} can advance at this stage.`);
    return;
  }

  if (state.status === 'helper') {
    alert('Helper does not advance workflow. Witness only.');
    return;
  }

  const idx = STATUS_FLOW.indexOf(state.status);
  if (idx < STATUS_FLOW.length - 1) {
    state.status = STATUS_FLOW[idx + 1];
    render();
  }
};

window.updateCF = (i, v) => {
  state.inventory[i].cf = Number(v) || 0;
  render();
};

window.addInventory = () => {
  const name = document.getElementById('newItemName').value.trim();
  const cf = Number(document.getElementById('newItemCF').value) || 0;

  if (!name) return alert('Item needs a name. Reality still applies.');

  state.inventory.push({ name, cf });
  document.getElementById('newItemName').value = '';
  document.getElementById('newItemCF').value = '';
  render();
};

/******************************
 * RENDER
 ******************************/
function render() {
  const app = document.getElementById('app');

  app.innerHTML = `
  <header class="flex justify-between items-center mb-6 pb-4 border-b">
    <h1 class="text-2xl font-black italic">FleetFLOW – MoveMaster OS</h1>
    <select onchange="setRole(this.value)" class="border rounded px-2 py-1 text-sm font-bold">
      ${STATUS_FLOW.map(r => `<option ${state.role===r?'selected':''}>${r}</option>`).join('')}
    </select>
  </header>

  <section class="mb-6">
    <div class="flex justify-between items-center">
      <div class="text-sm font-black uppercase">Current Baton: ${state.status}</div>
      <button onclick="advanceStatus()" class="bg-stone-900 text-white px-4 py-2 rounded font-black text-xs">Advance</button>
    </div>
  </section>

  ${renderRolePanel()}
  `;
}

/******************************
 * ROLE PANELS
 ******************************/
function renderRolePanel() {
  switch(state.role) {
    case 'driver': return driverPanel();
    case 'helper': return helperPanel();
    case 'office': return officePanel();
    case 'warehouse': return warehousePanel();
    case 'client': return clientPanel();
  }
}

function inventoryList(editable) {
  return `
    <div class="bg-white rounded-xl shadow">
      <div class="p-4 border-b font-black text-sm">Inventory – ${totalCF()} CF</div>
      ${state.inventory.map((i, idx) => `
        <div class="p-3 flex justify-between items-center gap-2">
          <span class="flex-1 font-bold text-sm">${i.name}</span>
          ${editable ? `<input type="number" class="w-20 border rounded text-xs text-right" value="${i.cf}" onchange="updateCF(${idx},this.value)" />` : `<span class="text-xs font-black">${i.cf} CF</span>`}
        </div>
      `).join('')}
    </div>`;
}

function driverPanel() {
  return `
  <section class="space-y-4">
    <div class="bg-blue-50 border rounded-xl p-4">
      <div class="font-black mb-2">Driver Earnings</div>
      <div class="text-sm">Hourly: $${state.driverPay.rate}/hr</div>
      <div class="text-sm">Commission: $${driverCommission()}</div>
    </div>

    ${inventoryList(true)}

    <div class="bg-white p-4 rounded-xl shadow">
      <div class="font-black text-sm mb-2">Add Inventory</div>
      <div class="flex gap-2">
        <input id="newItemName" placeholder="Item name" class="border rounded px-2 py-1 text-sm flex-1" />
        <input id="newItemCF" placeholder="CF" type="number" class="border rounded px-2 py-1 text-sm w-24" />
        <button onclick="addInventory()" class="bg-blue-600 text-white px-3 rounded font-black text-xs">Add</button>
      </div>
    </div>
  </section>`;
}

function helperPanel() {
  return `
  <section class="space-y-4">
    <div class="bg-green-50 border rounded-xl p-4">
      <div class="font-black mb-2">Helper Pay</div>
      <div class="text-sm">Hourly Rate: $${state.helperPay.rate}/hr</div>
      <div class="text-xs text-stone-500 mt-2">Witness + labor only. No decision authority.</div>
    </div>
    ${inventoryList(false)}
  </section>`;
}

function officePanel() {
  return `
  <section class="space-y-4">
    <div class="bg-white p-4 rounded-xl shadow">
      <div class="font-black">Office Control Hub</div>
      <p class="text-sm text-stone-600">All validation, approvals, and routing occur here.</p>
    </div>
    ${inventoryList(false)}
  </section>`;
}

function warehousePanel() {
  return `
  <section class="space-y-4">
    <div class="bg-white p-4 rounded-xl shadow">
      <div class="font-black">Warehouse Verification</div>
      <p class="text-sm">Inventory cross-check and staging confirmation.</p>
    </div>
    ${inventoryList(false)}
  </section>`;
}

function clientPanel() {
  return `
  <section class="space-y-4">
    <div class="bg-white p-4 rounded-xl shadow">
      <div class="font-black">Client Confirmation</div>
      <p class="text-sm">Final acknowledgment of delivered items.</p>
    </div>
    ${inventoryList(false)}
  </section>`;
}

render();
</script>
</body>
</html>
